<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grievance Submission</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background-color: #fdf3a7;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Courier Prime', monospace;
    padding: 40px 20px;
    position: relative;
    background-attachment: fixed;
    background-image:
      linear-gradient(to right, transparent 68px, #e8474a 68px, #e8474a 71px, transparent 71px),
      repeating-linear-gradient(
        to bottom,
        transparent,
        transparent 27px,
        #9ec4e8 27px,
        #9ec4e8 29px
      );
  }

  .form-wrapper { width: 100%; max-width: 560px; margin: 0 auto; }

  .form-title {
    font-family: 'Playfair Display', serif;
    font-size: 11px; font-weight: 700;
    letter-spacing: 0.35em; text-transform: uppercase;
    text-align: center; margin-bottom: 6px; color: #000;
  }

  .form-headline {
    font-family: 'Playfair Display', serif;
    font-size: 38px; font-weight: 900;
    text-align: center; line-height: 1.05;
    margin-bottom: 32px; color: #000; letter-spacing: -0.01em;
  }

  .form-body {
    background: #fff;
    border-radius: 100px;
    border: 6px solid #000;
    outline: 6px solid #000;
    outline-offset: 5px;
    padding: 44px 52px 44px;
    position: relative;
  }

  .field-group {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 18px; margin-bottom: 18px;
  }

  .field { display: flex; flex-direction: column; gap: 6px; }

  label {
    font-size: 10px; font-weight: 700;
    letter-spacing: 0.2em; text-transform: uppercase; color: #000;
  }

  input[type="text"], input[type="tel"], input[type="email"] {
    background: #fff; border: none;
    border-bottom: 2px solid #000;
    padding: 8px 0 6px;
    font-family: 'Courier Prime', monospace;
    font-size: 15px; color: #000; outline: none;
    width: 100%; transition: border-color 0.2s;
  }

  input:focus { border-bottom-color: #555; }
  input.error { border-bottom-color: #c00; }

  .error-msg {
    font-size: 10px; color: #c00;
    letter-spacing: 0.05em; min-height: 14px; display: block;
  }

  /* Upload area */
  .upload-area {
    border: 2px dashed #000; padding: 22px;
    text-align: center; cursor: pointer;
    border-radius: 8px; transition: background 0.2s;
    position: relative; margin-top: 4px;
  }

  .upload-area:hover { background: #f5f5f5; }

  .upload-area input[type="file"] {
    position: absolute; inset: 0; opacity: 0;
    cursor: pointer; width: 100%; height: 100%;
  }

  .upload-icon { font-size: 28px; margin-bottom: 6px; display: block; }

  .upload-label {
    font-size: 11px; font-weight: 700;
    letter-spacing: 0.15em; text-transform: uppercase;
  }

  .upload-sub { font-size: 10px; color: #666; margin-top: 3px; letter-spacing: 0.05em; }

  /* File list */
  .file-list {
    margin-top: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .file-list-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f7f7f7;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px 10px;
    font-size: 11px;
    font-family: 'Courier Prime', monospace;
  }

  .file-list-item span {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 85%;
  }

  .file-remove {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
    color: #c00;
    padding: 0 2px;
    line-height: 1;
    flex-shrink: 0;
  }

  .file-remove:hover { color: #900; }

  .file-count {
    font-size: 10px;
    color: #555;
    margin-top: 6px;
    letter-spacing: 0.05em;
    text-align: center;
  }

  .divider { border: none; border-top: 1px solid #ccc; margin: 28px 0; }

  .submit-btn {
    width: 100%; background: #000; color: #fff; border: none;
    padding: 16px 24px;
    font-family: 'Courier Prime', monospace;
    font-size: 13px; font-weight: 700;
    letter-spacing: 0.2em; text-transform: uppercase;
    cursor: pointer; border-radius: 60px;
    transition: background 0.2s, transform 0.1s;
    min-height: 52px;
  }

  .submit-btn:hover:not(:disabled) { background: #333; }
  .submit-btn:active:not(:disabled) { transform: scale(0.98); }
  .submit-btn:disabled { cursor: not-allowed; opacity: 0.85; }
  .submit-btn.submitting { letter-spacing: 0.08em; font-size: 11px; }

  /* Animated dots */
  @keyframes dotBounce {
    0%, 80%, 100% { transform: translateY(0); opacity: 0.3; }
    40%           { transform: translateY(-5px); opacity: 1; }
  }

  .dots {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    margin-left: 4px;
    vertical-align: middle;
    position: relative;
    top: -1px;
  }

  .dots span {
    display: inline-block;
    width: 5px;
    height: 5px;
    background: #fff;
    border-radius: 50%;
    animation: dotBounce 1.2s infinite ease-in-out;
  }

  .dots span:nth-child(1) { animation-delay: 0s;    }
  .dots span:nth-child(2) { animation-delay: 0.2s;  }
  .dots span:nth-child(3) { animation-delay: 0.4s;  }
  .dots span:nth-child(4) { animation-delay: 0.6s;  }

  /* Progress bar */
  .progress-wrap {
    display: none;
    margin-top: 14px;
  }
  .progress-wrap.visible { display: block; }
  .progress-bar-bg {
    background: #eee;
    border-radius: 20px;
    height: 6px;
    overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%;
    background: #000;
    border-radius: 20px;
    width: 0%;
    transition: width 0.3s ease;
  }
  .progress-label {
    font-size: 10px;
    letter-spacing: 0.1em;
    text-align: center;
    margin-top: 5px;
    color: #555;
  }

  @media (max-width: 600px) {
    body {
      padding: 24px 16px;
      background-attachment: scroll;
    }
    .form-body {
      border-radius: 40px;
      padding: 32px 24px 32px;
      outline-offset: 4px;
    }
    .form-headline {
      font-size: 28px;
    }
    .field-group {
      grid-template-columns: 1fr;
    }
  }

  .stamp {
    text-align: center; margin-top: 22px;
    font-size: 9px; letter-spacing: 0.25em;
    color: #aaa; text-transform: uppercase;
  }
</style>
</head>
<body>

<div class="form-wrapper">
  <div class="form-body">
    <p class="form-title">LAAPOA</p>
    <h1 class="form-headline">Grievance<br>Submission</h1>
    <hr class="divider" style="margin-bottom: 28px;">

    <form id="grievanceForm" novalidate>

      <div class="field-group">
        <div class="field">
          <label for="lastName">Last Name</label>
          <input type="text" id="lastName" name="lastName" autocomplete="family-name" placeholder="Doe">
          <span class="error-msg" id="lastNameErr"></span>
        </div>
        <div class="field">
          <label for="firstName">First Name</label>
          <input type="text" id="firstName" name="firstName" autocomplete="given-name" placeholder="John">
          <span class="error-msg" id="firstNameErr"></span>
        </div>
      </div>

      <div class="field-group">
        <div class="field">
          <label for="phone">Phone Number</label>
          <input type="tel" id="phone" name="phone" autocomplete="tel" placeholder="(310) 555-0100">
          <span class="error-msg" id="phoneErr"></span>
        </div>
        <div class="field">
          <label for="email">Personal Email</label>
          <input type="email" id="email" name="email" autocomplete="email" placeholder="john@email.com">
          <span class="error-msg" id="emailErr"></span>
        </div>
      </div>

      <div class="field">
        <label>Supporting Documents</label>
        <div class="upload-area" id="uploadArea">
          <input type="file" id="fileUpload" name="fileUpload"
                 accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                 multiple>
          <span class="upload-icon">ðŸ“Ž</span>
          <span class="upload-label">Click to Upload Files</span>
          <p class="upload-sub">PDF, Word, or Image â€” multiple files allowed â€” max 10 MB each</p>
        </div>
        <div class="file-list" id="fileList"></div>
        <p class="file-count" id="fileCount"></p>
        <span class="error-msg" id="fileErr"></span>
      </div>

      <hr class="divider">

      <button type="submit" class="submit-btn" id="submitBtn">
        Submit Grievance
      </button>

      <div class="progress-wrap" id="progressWrap">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <p class="progress-label" id="progressLabel"></p>
      </div>

    </form>
  </div>

  <p class="stamp">All submissions are confidential &bull; LAAPOA &copy; 2026</p>
</div>

<script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz7Sl4y_vvIRM5LhaOuKTwBHe7QtMcuoQvwDa09ky2erqeJ31IynA4VnLY89eufs9VdXg/exec';

  const form         = document.getElementById('grievanceForm');
  const submitBtn    = document.getElementById('submitBtn');
  const fileInput    = document.getElementById('fileUpload');
  const fileListEl   = document.getElementById('fileList');
  const fileCountEl  = document.getElementById('fileCount');
  const progressWrap = document.getElementById('progressWrap');
  const progressFill = document.getElementById('progressFill');
  const progressLabel= document.getElementById('progressLabel');

  // Track selected files in an array (allows removal)
  let selectedFiles = [];

  fileInput.addEventListener('change', () => {
    // Merge new files into selectedFiles, skip duplicates by name
    Array.from(fileInput.files).forEach(f => {
      if (!selectedFiles.find(x => x.name === f.name && x.size === f.size)) {
        selectedFiles.push(f);
      }
    });
    // Reset input so same file can be re-added after removal
    fileInput.value = '';
    renderFileList();
  });

  function renderFileList() {
    fileListEl.innerHTML = '';
    selectedFiles.forEach((f, i) => {
      const item = document.createElement('div');
      item.className = 'file-list-item';
      item.innerHTML = `
        <span>ðŸ“„ ${f.name} <em style="color:#888">(${(f.size/1024).toFixed(0)} KB)</em></span>
        <button type="button" class="file-remove" data-index="${i}" title="Remove">âœ•</button>
      `;
      fileListEl.appendChild(item);
    });

    // Remove buttons
    fileListEl.querySelectorAll('.file-remove').forEach(btn => {
      btn.addEventListener('click', () => {
        selectedFiles.splice(parseInt(btn.dataset.index), 1);
        renderFileList();
      });
    });

    fileCountEl.textContent = selectedFiles.length > 0
      ? `${selectedFiles.length} file${selectedFiles.length > 1 ? 's' : ''} selected`
      : '';
  }

  function setError(inputId, errId, msg) {
    const el  = document.getElementById(inputId);
    const err = document.getElementById(errId);
    if (msg) { el && el.classList.add('error');    err.textContent = msg; }
    else      { el && el.classList.remove('error'); err.textContent = '';  }
    return !!msg;
  }

  function validate() {
    let hasErr  = false;
    const lastName  = document.getElementById('lastName').value.trim();
    const firstName = document.getElementById('firstName').value.trim();
    const phone     = document.getElementById('phone').value.trim();
    const email     = document.getElementById('email').value.trim();

    hasErr = setError('lastName',  'lastNameErr',  lastName  ? '' : 'Last name is required.')  || hasErr;
    hasErr = setError('firstName', 'firstNameErr', firstName ? '' : 'First name is required.') || hasErr;

    const phoneClean = phone.replace(/\D/g, '');
    hasErr = setError('phone', 'phoneErr',
      !phone                 ? 'Phone number is required.'   :
      phoneClean.length < 10 ? 'Enter a valid phone number.' : ''
    ) || hasErr;

    let emailErr = '';
    if (!email)                                          emailErr = 'Email is required.';
    else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) emailErr = 'Enter a valid email address.';
    else if (email.toLowerCase().endsWith('@lawa.org'))  emailErr = '@lawa.org addresses are not permitted.';
    hasErr = setError('email', 'emailErr', emailErr) || hasErr;

    return !hasErr;
  }

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload  = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  function setProgress(pct, label) {
    progressWrap.classList.add('visible');
    progressFill.style.width = pct + '%';
    progressLabel.textContent = label;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validate()) return;

    const lastName  = document.getElementById('lastName').value.trim();
    const firstName = document.getElementById('firstName').value.trim();
    const phone     = document.getElementById('phone').value.trim();
    const email     = document.getElementById('email').value.trim();

    submitBtn.disabled = true;
    submitBtn.classList.add('submitting');
    submitBtn.innerHTML = `Your snitch info is being sent ${firstName}.<span class="dots"><span></span><span></span><span></span><span></span></span>`;

    try {
      // Build files array with base64 data
      const files = [];
      const total = selectedFiles.length;

      for (let i = 0; i < total; i++) {
        const f = selectedFiles[i];
        setProgress(
          Math.round(((i) / Math.max(total, 1)) * 70),
          `Preparing file ${i + 1} of ${total}...`
        );
        const b64 = await fileToBase64(f);
        files.push({
          fileName: f.name,
          fileMime: f.type || 'application/octet-stream',
          fileData: b64
        });
      }

      setProgress(75, 'Sending to server...');

      const payload = { lastName, firstName, phone, email, files };

      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        body:   JSON.stringify(payload)
      });

      setProgress(95, 'Finalizing...');

      const result = await response.json();

      if (result.result === 'success') {
        setProgress(100, 'Done!');
        submitBtn.textContent      = 'âœ” Submitted â€” Check your email for confirmation.';
        submitBtn.style.background = '#1a6e2e';
        form.reset();
        selectedFiles = [];
        renderFileList();
      } else {
        throw new Error(result.message || 'Unknown error');
      }

    } catch (err) {
      console.error(err);
      progressWrap.classList.remove('visible');
      submitBtn.disabled = false;
      submitBtn.classList.remove('submitting');
      submitBtn.textContent      = 'Submission Failed â€” Please Try Again';
      submitBtn.style.background = '#c00';
      setTimeout(() => {
        submitBtn.style.background = '#000';
        submitBtn.textContent      = 'Submit Grievance';
      }, 4000);
    }
  });
</script>
</body>
</html>
